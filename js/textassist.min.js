/**
 * "textAssist"
 * 
 * @version: 1.0, 12.12.2014
 * 
 * @author: Hemn Chawroka
 *		  http://iprodev.com
 * 
 * @example: $('selector').textAssist();
 * 
 */
(function(d){function m(){if(window.getSelection)return window.getSelection();if(document.getSelection)return document.getSelection();var b=document.selection&&document.selection.createRange();return b.text?b.text:!1}function f(b,d,a){return a?b.replace(/{%s}/ig,encodeURIComponent(d)):b.replace(/{%s}/ig,d)}var n=d(window),g=d(document),k=function(b,e){var a=this;a.settings=jQuery.extend({minLength:"3",delay:"10",items:[]},e);a.$el=d(b);a.$assist=d("<div class='textassist'><ul></ul></div>");a.$container=a.$assist.children("ul");a.selection="";a.showable=!0;g.on("mousedown",function(c){c=d(c.target);c[0]===a.$assist[0]||c.parents(".textassist")[0]||(a.closeMenu(),c.is("input:password")?a.showable=!1:a.showable=!0)});a.$el.on("mouseup",function(c){a.$assist.is(":visible")||setTimeout(function(){a.selection=d.trim(String(m()).replace("false",""));if(a.selection.length>=a.settings.minLength&&a.showable){a.appendCont();var b=a.$assist.outerHeight(),e=n.height(),f=g.scrollTop(),h=c.pageY,l=c.pageX+16;f+e<b+c.pageY&&(h=c.pageY-b);a.$assist.css({top:h,left:l}).show()}},a.settings.delay)})};k.prototype={closeMenu:function(){this.$container.find("li a").off("click");this.$container.empty();this.$assist.hide().remove()},appendCont:function(){var b=this;d("body").append(b.$assist);d.each(b.settings.items,function(a,c){var e;if(c.divider)e=d('<li rel="'+b.settings.assistID+'" class="divider"></li>');else{var g=f(c.title,b.selection),k=c.classN?' class="'+c.classN+'"':"",h=c.href?' href="'+f(c.href,b.selection,1)+'"':"",l=c.target?' target="'+f(c.target,b.selection)+'"':"";e=d("<li><a "+h+k+l+"><span>"+g+"</span></a></li>");if(c.onClick)e.children("a").on("click",function(){c.onClick.call(b,b.selection,e)});c.onShow&&c.onShow.call(b,b.selection,e)}b.$container.append(e)});var e=b.$container.find("li:visible");e.addClass("visible");e.first().addClass("first");e.last().addClass("last")}};d.fn.textAssist=function(b){return this.each(function(e,a){d.data(a,"textAssist",new k(a,b))})}})(jQuery);